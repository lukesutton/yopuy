<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Yopuy  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="Yopuy  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          Yopuy Docs
        </a>
         (100% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/lukesutton/yopuy">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="dash-feed://https%3A%2F%2Flukesutton%2Egithub%2Eio%2Fdocsets%2FYopuy%2Exml">
            <img class="header-icon" src="img/dash.png"/>
            Install in Dash
          </a>
        </p>
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">Yopuy Reference</a>
      <img class="carat" src="img/carat.png" />
      Yopuy  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enums</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/AdapterResponse.html">AdapterResponse</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums.html#/s:O5Yopuy14CollectionPath">CollectionPath</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums.html#/s:O5Yopuy6DELETE">DELETE</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums.html#/s:O5Yopuy3GET">GET</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/HTTPMethod.html">HTTPMethod</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/HTTPResult.html">HTTPResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/Header.html">Header</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums.html#/s:O5Yopuy5PATCH">PATCH</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums.html#/s:O5Yopuy4POST">POST</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums.html#/s:O5Yopuy3PUT">PUT</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/Response.html">Response</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums.html#/s:O5Yopuy12SingularPath">SingularPath</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions//(_:_:).html">/(_:_:)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/AdapterRequest.html">AdapterRequest</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols.html#/s:P5Yopuy13ChildResource">ChildResource</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/HTTPAdapter.html">HTTPAdapter</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/IdentifiableResource.html">IdentifiableResource</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/IsCreatable.html">IsCreatable</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/IsDeletable.html">IsDeletable</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/IsListable.html">IsListable</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/IsPatchable.html">IsPatchable</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols.html#/s:P5Yopuy9IsRESTFul">IsRESTFul</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/IsReplaceable.html">IsReplaceable</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/IsShowable.html">IsShowable</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols.html#/s:P5Yopuy14NestedResource">NestedResource</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/Resource.html">Resource</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols.html#/s:P5Yopuy12RootResource">RootResource</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols.html#/s:P5Yopuy21SingularChildResource">SingularChildResource</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols.html#/s:P5Yopuy20SingularRootResource">SingularRootResource</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Structs.html">Structs</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ChildPath.html">ChildPath</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Options.html">Options</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Path.html">Path</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Request.html">Request</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Service.html">Service</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <p><img src="https://cdn.rawgit.com/lukesutton/yopuy/master/logo.svg" alt=""></p>
<a href='#yopuy-type-safe-glue-for-rest-apis' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='yopuy-type-safe-glue-for-rest-apis'>Yopuy - Type-safe glue for REST APIs</h1>

<p><a href="https://travis-ci.org/lukesutton/yopuy"><img src="https://travis-ci.org/lukesutton/yopuy.svg?branch=master" alt="Build Status"></a>
<a href="https://codecov.io/gh/lukesutton/yopuy"><img src="https://codecov.io/gh/lukesutton/yopuy/branch/master/graph/badge.svg" alt="codecov"></a></p>

<p>An experiment with a simple wrapper for accessing JSON/REST web APIs. Inspired by <a href="https://talk.objc.io/episodes/S01E01-networking">an episode</a> of Swift Talk.</p>

<p>The main aims for this library are:</p>

<ul>
<li>Type-safety where appropriate</li>
<li>Encoding/decoding agnostic</li>
<li>HTTP client agnostic</li>
</ul>

<p>Here is an example of it in use.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">service</span> <span class="o">=</span> <span class="kt">Service</span><span class="p">(</span><span class="nv">adapter</span><span class="p">:</span> <span class="kt">YourFancyAdapter</span><span class="p">(),</span> <span class="kt">URL</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">comment</span> <span class="o">=</span> <span class="kt">Post</span><span class="o">.</span><span class="nf">show</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="kt">Comment</span><span class="o">.</span><span class="nf">show</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

<span class="n">service</span><span class="o">.</span><span class="nf">call</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<a href='#resources' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='resources'>Resources</h2>

<p>Yopuy handles the interaction with an API via types which conform to the <code>Resource</code> protocol. The <code>Resource</code> protocol, various <code>associatedtype</code> declarations and other related protocols — e.g. <code>ChildResource</code>, <code>RootResource</code> — are used to grant capabilities to these types. Generally these are static functions and properties which return values representing full or partial paths to a resource.</p>

<p>For example, a <code>RootResource</code> is one that has a path that exists at the root of an API. This adds a number of constraints.</p>

<ul>
<li>It cannot belong to a parent resource</li>
<li>Any path it generates will be at the root of the API</li>
</ul>

<p>A corresponding protocol is <code>ChildResource</code>. It has an <code>associatedtype Parent</code> requirement. This associates a child resource with it&rsquo;s parent. It then guides the type-safe construction of paths e.g. <code>Post.show(1) / Comment.show(12)</code></p>
<a href='#fine-grained-capabilities' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='fine-grained-capabilities'>Fine-Grained Capabilities</h2>

<p>By default a <code>Resource</code> lacks any of the path static functions or properties. These are provided by conforming to protocols. Most of the protocols correspond to a HTTP method.</p>

<ul>
<li><code>IsListable</code>; can be retrieved as a collection e.g. <code>GET /posts</code></li>
<li><code>IsShowable</code>; can be retrieved as a single record e.g. <code>GET /posts/1</code></li>
<li><code>IsCreatable</code>; new resources can be created e.g. <code>POST /posts</code></li>
<li><code>IsReplaceable</code>; a resource can be updated via <code>PUT</code> e.g. <code>PUT /posts/1</code></li>
<li><code>IsPatchable</code>; a resource can be updated via <code>PATCH</code> e.g. <code>PATCH /posts/1</code></li>
<li><code>IsDeletable</code>; a resource can be deleted via <code>DELETE</code> e.g. <code>DELETE /posts/1</code></li>
</ul>

<p>Here is an example of a record that can be updated, but not created or deleted.</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Foo</span><span class="p">:</span> <span class="kt">RootResource</span><span class="p">,</span> <span class="kt">IsPatchable</span><span class="p">,</span> <span class="kt">IsShowable</span> <span class="p">{</span>
  <span class="c1">// Details elided...</span>
<span class="p">}</span>
</code></pre>
<a href='#http-client-agnostic' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='http-client-agnostic'>HTTP Client Agnostic</h2>

<p>All requests in Yopuy are handled by an instance of the <code>Service</code>. It is HTTP client agnostic by delegating all requests to an adapter, which is defined via the <code>HTTPAdapter</code> protocol. Here is it&rsquo;s full definition.</p>
<pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">HTTPAdapter</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">perform</span><span class="p">(</span><span class="n">_</span> <span class="nv">method</span><span class="p">:</span> <span class="kt">HTTPMethod</span><span class="p">,</span> <span class="nv">request</span><span class="p">:</span> <span class="kt">AdapterRequest</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">AdapterResponse</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Only one function is required and it&rsquo;s signature is pretty simple at that. The adapter is free to do what ever it needs in the implementation; the only hard-requirement is that it calls the <code>callback</code> function.</p>

<p>Aside from allowing support of arbitrary HTTP clients, this approach makes testing trivial. It&rsquo;s easy to define a test adapter that returns the required responses.</p>
<a href='#bring-your-own-serialisation' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='bring-your-own-serialisation'>Bring Your Own Serialisation</h2>

<p>Yopuy uses a similar approach to integrating the serialisation library of your choice. Depending on how you define your resources, you will need to conform to one or both of the parsing functions; <code>parse(collection:)</code> and <code>parse(singular:)</code>. Yopuy will choose the parsing function based on the type of request.</p>

<p>For example, if you conform your resource to the <code>IsShowable</code> protocol, it must implement <code>parse(singular:)</code>. Another example is the <code>IsListable</code> protocol. This requires the <code>parse(collection:)</code> function.</p>

<p>Within those functions, you are free to implement your parsing however you choose.</p>
<a href='#a-longer-example' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='a-longer-example'>A Longer Example</h2>

<p>This is a simple example of how we can encode a type-safe hierarchy of resources. They don&rsquo;t have any properties defined, since they are only demonstrating how parent and child resources are related. The <code>IsRESTFul</code> protocol is used to extend the structs with all the HTTP verbs used in a REST API. Also note how the <code>Commenter</code> struct is extended by a subset of the protocols available.</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Post</span><span class="p">:</span> <span class="kt">RootResource</span><span class="p">,</span> <span class="kt">IsRESTFul</span> <span class="p">{</span>
    <span class="kd">typealias</span> <span class="kt">ID</span> <span class="o">=</span> <span class="kt">Int</span>
    <span class="kd">typealias</span> <span class="kt">Collection</span> <span class="o">=</span> <span class="p">[</span><span class="kt">Post</span><span class="p">]</span>
    <span class="kd">typealias</span> <span class="kt">Singular</span> <span class="o">=</span> <span class="kt">Post</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">path</span> <span class="o">=</span> <span class="s">"posts"</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">parse</span><span class="p">(</span><span class="n">collection</span> <span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">Collection</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[]</span>
    <span class="p">}</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">parse</span><span class="p">(</span><span class="n">singular</span> <span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">Singular</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kt">Post</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">20</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Comment</span><span class="p">:</span> <span class="kt">ChildResource</span><span class="p">,</span> <span class="kt">IsRESTFul</span> <span class="p">{</span>
    <span class="kd">typealias</span> <span class="kt">ID</span> <span class="o">=</span> <span class="kt">Int</span>
    <span class="kd">typealias</span> <span class="kt">Parent</span> <span class="o">=</span> <span class="kt">Post</span>
    <span class="kd">typealias</span> <span class="kt">Collection</span> <span class="o">=</span> <span class="p">[</span><span class="kt">Comment</span><span class="p">]</span>
    <span class="kd">typealias</span> <span class="kt">Singular</span> <span class="o">=</span> <span class="kt">Comment</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">path</span> <span class="o">=</span> <span class="s">"comments"</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">parse</span><span class="p">(</span><span class="n">collection</span> <span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">Collection</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[]</span>
    <span class="p">}</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">parse</span><span class="p">(</span><span class="n">singular</span> <span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">Singular</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kt">Comment</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">20</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Commenter</span><span class="p">:</span> <span class="kt">ChildResource</span><span class="p">,</span> <span class="kt">IsShowable</span><span class="p">,</span> <span class="kt">IsListable</span><span class="p">,</span> <span class="kt">IsDeletable</span> <span class="p">{</span>
    <span class="kd">typealias</span> <span class="kt">ID</span> <span class="o">=</span> <span class="kt">Int</span>
    <span class="kd">typealias</span> <span class="kt">Parent</span> <span class="o">=</span> <span class="kt">Comment</span>
    <span class="kd">typealias</span> <span class="kt">Collection</span> <span class="o">=</span> <span class="p">[</span><span class="kt">Commenter</span><span class="p">]</span>
    <span class="kd">typealias</span> <span class="kt">Singular</span> <span class="o">=</span> <span class="kt">Commenter</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">path</span> <span class="o">=</span> <span class="s">"commenter"</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">parse</span><span class="p">(</span><span class="n">collection</span> <span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">Collection</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[]</span>
    <span class="p">}</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">parse</span><span class="p">(</span><span class="n">singular</span> <span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">Singular</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kt">Commenter</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">20</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">e</span> <span class="o">=</span> <span class="kt">Post</span><span class="o">.</span><span class="nf">show</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="kt">Comment</span><span class="o">.</span><span class="nf">show</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="kt">Commenter</span><span class="o">.</span><span class="nf">delete</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre>

<p>There are a few interesting things about the example above:</p>

<ul>
<li>Resources are either <code>RootResource</code> or <code>ChildResource</code> which dictates how they can be used</li>
<li>Constructing a path like <code>Post.show(1) / Commenter.show(5)</code> is a type-error, since <code>Commenter</code> has <code>Comment</code> as it&rsquo;s parent</li>
<li>Making <code>Post</code> a child is a type error, since it is a <code>RootResource</code></li>
<li>Constructing a path with a child resource at the root is also a type-error</li>
<li>It&rsquo;s configured so that a <code>create</code> path can&rsquo;t be constructed for the <code>Commenter</code> resource</li>
<li>Paths also encode the HTTP verb</li>
<li>Parsing is entirely delegated to your code; use whatever parsing library you prefer</li>
<li>The operations on collections and resources are encoded in separate protocols — e.g. <code>IsDeletable</code>, <code>IsListable</code> — meaning you can pick and choose what you include</li>
<li><code>IsRESTful</code> is just a shortcut for including all the <code>Is*</code> protocols on a resource</li>
<li>Declaring a resource without the <code>IsRESTful</code> or <code>Is*</code> protocols means they&rsquo;re useless, all methods come from optional protocols</li>
<li>Using typealias means the results of your requests can be arbitrary types e.g. <code>CustomCollection&lt;Post&gt;</code></li>
</ul>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2017 <a class="link" href="https://github.com/lukesutton" target="_blank" rel="external">Luke Sutton</a>. All rights reserved. (Last updated: 2017-05-03)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.7.5</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
